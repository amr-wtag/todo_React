{"ast":null,"code":"import { Transformers } from '@supabase/realtime-js';\nexport class SupabaseRealtimeClient {\n  constructor(socket, headers, schema, tableName) {\n    const chanParams = {};\n    const topic = tableName === '*' ? `realtime:${schema}` : `realtime:${schema}:${tableName}`;\n    const userToken = headers['Authorization'].split(' ')[1];\n\n    if (userToken) {\n      chanParams['user_token'] = userToken;\n    }\n\n    this.subscription = socket.channel(topic, chanParams);\n  }\n\n  getPayloadRecords(payload) {\n    const records = {\n      new: {},\n      old: {}\n    };\n\n    if (payload.type === 'INSERT' || payload.type === 'UPDATE') {\n      records.new = Transformers.convertChangeData(payload.columns, payload.record);\n    }\n\n    if (payload.type === 'UPDATE' || payload.type === 'DELETE') {\n      records.old = Transformers.convertChangeData(payload.columns, payload.old_record);\n    }\n\n    return records;\n  }\n  /**\n   * The event you want to listen to.\n   *\n   * @param event The event\n   * @param callback A callback function that is called whenever the event occurs.\n   */\n\n\n  on(event, callback) {\n    this.subscription.on(event, payload => {\n      let enrichedPayload = {\n        schema: payload.schema,\n        table: payload.table,\n        commit_timestamp: payload.commit_timestamp,\n        eventType: payload.type,\n        new: {},\n        old: {},\n        errors: payload.errors\n      };\n      enrichedPayload = Object.assign(Object.assign({}, enrichedPayload), this.getPayloadRecords(payload));\n      callback(enrichedPayload);\n    });\n    return this;\n  }\n  /**\n   * Enables the subscription.\n   */\n\n\n  subscribe() {\n    let callback = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : () => {};\n    this.subscription.onError(e => callback('SUBSCRIPTION_ERROR', e));\n    this.subscription.onClose(() => callback('CLOSED'));\n    this.subscription.subscribe().receive('ok', () => callback('SUBSCRIBED')).receive('error', e => callback('SUBSCRIPTION_ERROR', e)).receive('timeout', () => callback('RETRYING_AFTER_TIMEOUT'));\n    return this.subscription;\n  }\n\n}","map":{"version":3,"mappings":"AAAA,SAA+CA,YAA/C,QAAmE,uBAAnE;AAGA,OAAM,MAAOC,sBAAP,CAA6B;AAGjCC,cAAYC,MAAZ,EAAoCC,OAApC,EAA4DC,MAA5D,EAA4EC,SAA5E,EAA6F;AAC3F,UAAMC,UAAU,GAAkB,EAAlC;AACA,UAAMC,KAAK,GAAGF,SAAS,KAAK,GAAd,GAAoB,YAAYD,MAAM,EAAtC,GAA2C,YAAYA,MAAM,IAAIC,SAAS,EAAxF;AACA,UAAMG,SAAS,GAAGL,OAAO,CAAC,eAAD,CAAP,CAAyBM,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAlB;;AAEA,QAAID,SAAJ,EAAe;AACbF,gBAAU,CAAC,YAAD,CAAV,GAA2BE,SAA3B;AACD;;AAED,SAAKE,YAAL,GAAoBR,MAAM,CAACS,OAAP,CAAeJ,KAAf,EAAsBD,UAAtB,CAApB;AACD;;AAEOM,mBAAiB,CAACC,OAAD,EAAa;AACpC,UAAMC,OAAO,GAAG;AACdC,SAAG,EAAE,EADS;AAEdC,SAAG,EAAE;AAFS,KAAhB;;AAKA,QAAIH,OAAO,CAACI,IAAR,KAAiB,QAAjB,IAA6BJ,OAAO,CAACI,IAAR,KAAiB,QAAlD,EAA4D;AAC1DH,aAAO,CAACC,GAAR,GAAchB,YAAY,CAACmB,iBAAb,CAA+BL,OAAO,CAACM,OAAvC,EAAgDN,OAAO,CAACO,MAAxD,CAAd;AACD;;AAED,QAAIP,OAAO,CAACI,IAAR,KAAiB,QAAjB,IAA6BJ,OAAO,CAACI,IAAR,KAAiB,QAAlD,EAA4D;AAC1DH,aAAO,CAACE,GAAR,GAAcjB,YAAY,CAACmB,iBAAb,CAA+BL,OAAO,CAACM,OAAvC,EAAgDN,OAAO,CAACQ,UAAxD,CAAd;AACD;;AAED,WAAOP,OAAP;AACD;AAED;;;;;;;;AAMAQ,IAAE,CAACC,KAAD,EAA4BC,QAA5B,EAAqF;AACrF,SAAKd,YAAL,CAAkBY,EAAlB,CAAqBC,KAArB,EAA6BV,OAAD,IAAiB;AAC3C,UAAIY,eAAe,GAAiC;AAClDrB,cAAM,EAAES,OAAO,CAACT,MADkC;AAElDsB,aAAK,EAAEb,OAAO,CAACa,KAFmC;AAGlDC,wBAAgB,EAAEd,OAAO,CAACc,gBAHwB;AAIlDC,iBAAS,EAAEf,OAAO,CAACI,IAJ+B;AAKlDF,WAAG,EAAE,EAL6C;AAMlDC,WAAG,EAAE,EAN6C;AAOlDa,cAAM,EAAEhB,OAAO,CAACgB;AAPkC,OAApD;AAUAJ,qBAAe,mCAAQA,eAAR,GAA4B,KAAKb,iBAAL,CAAuBC,OAAvB,CAA5B,CAAf;AAEAW,cAAQ,CAACC,eAAD,CAAR;AACD,KAdD;AAeA,WAAO,IAAP;AACD;AAED;;;;;AAGAK,WAAS,GAA8B;AAAA,QAA7BN,QAA6B,uEAAR,MAAK,CAAG;AACrC,SAAKd,YAAL,CAAkBqB,OAAlB,CAA2BC,CAAD,IAAcR,QAAQ,CAAC,oBAAD,EAAuBQ,CAAvB,CAAhD;AACA,SAAKtB,YAAL,CAAkBuB,OAAlB,CAA0B,MAAMT,QAAQ,CAAC,QAAD,CAAxC;AACA,SAAKd,YAAL,CACGoB,SADH,GAEGI,OAFH,CAEW,IAFX,EAEiB,MAAMV,QAAQ,CAAC,YAAD,CAF/B,EAGGU,OAHH,CAGW,OAHX,EAGqBF,CAAD,IAAcR,QAAQ,CAAC,oBAAD,EAAuBQ,CAAvB,CAH1C,EAIGE,OAJH,CAIW,SAJX,EAIsB,MAAMV,QAAQ,CAAC,wBAAD,CAJpC;AAKA,WAAO,KAAKd,YAAZ;AACD;;AArEgC","names":["Transformers","SupabaseRealtimeClient","constructor","socket","headers","schema","tableName","chanParams","topic","userToken","split","subscription","channel","getPayloadRecords","payload","records","new","old","type","convertChangeData","columns","record","old_record","on","event","callback","enrichedPayload","table","commit_timestamp","eventType","errors","subscribe","onError","e","onClose","receive"],"sources":["/Users/mridha/Todo_in_React/todo/node_modules/@supabase/supabase-js/src/lib/SupabaseRealtimeClient.ts"],"sourcesContent":["import { RealtimeSubscription, RealtimeClient, Transformers } from '@supabase/realtime-js'\nimport { GenericObject, SupabaseEventTypes, SupabaseRealtimePayload } from './types'\n\nexport class SupabaseRealtimeClient {\n  subscription: RealtimeSubscription\n\n  constructor(socket: RealtimeClient, headers: GenericObject, schema: string, tableName: string) {\n    const chanParams: GenericObject = {}\n    const topic = tableName === '*' ? `realtime:${schema}` : `realtime:${schema}:${tableName}`\n    const userToken = headers['Authorization'].split(' ')[1]\n\n    if (userToken) {\n      chanParams['user_token'] = userToken\n    }\n\n    this.subscription = socket.channel(topic, chanParams) as RealtimeSubscription\n  }\n\n  private getPayloadRecords(payload: any) {\n    const records = {\n      new: {},\n      old: {},\n    }\n\n    if (payload.type === 'INSERT' || payload.type === 'UPDATE') {\n      records.new = Transformers.convertChangeData(payload.columns, payload.record)\n    }\n\n    if (payload.type === 'UPDATE' || payload.type === 'DELETE') {\n      records.old = Transformers.convertChangeData(payload.columns, payload.old_record)\n    }\n\n    return records\n  }\n\n  /**\n   * The event you want to listen to.\n   *\n   * @param event The event\n   * @param callback A callback function that is called whenever the event occurs.\n   */\n  on(event: SupabaseEventTypes, callback: (payload: SupabaseRealtimePayload<any>) => void) {\n    this.subscription.on(event, (payload: any) => {\n      let enrichedPayload: SupabaseRealtimePayload<any> = {\n        schema: payload.schema,\n        table: payload.table,\n        commit_timestamp: payload.commit_timestamp,\n        eventType: payload.type,\n        new: {},\n        old: {},\n        errors: payload.errors,\n      }\n\n      enrichedPayload = { ...enrichedPayload, ...this.getPayloadRecords(payload) }\n\n      callback(enrichedPayload)\n    })\n    return this\n  }\n\n  /**\n   * Enables the subscription.\n   */\n  subscribe(callback: Function = () => {}) {\n    this.subscription.onError((e: Error) => callback('SUBSCRIPTION_ERROR', e))\n    this.subscription.onClose(() => callback('CLOSED'))\n    this.subscription\n      .subscribe()\n      .receive('ok', () => callback('SUBSCRIBED'))\n      .receive('error', (e: Error) => callback('SUBSCRIPTION_ERROR', e))\n      .receive('timeout', () => callback('RETRYING_AFTER_TIMEOUT'))\n    return this.subscription\n  }\n}\n"]},"metadata":{},"sourceType":"module"}